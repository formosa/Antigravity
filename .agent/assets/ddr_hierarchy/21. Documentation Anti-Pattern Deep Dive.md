
## 21. Documentation Anti-Pattern Deep Dive

### 21.1 The "Implementation Leak" Anti-Pattern

**Problem:** Technical implementation details appearing in business/feature tiers.

**Example (WRONG):**

```
|FSD-X|: "The system uses zmq.ROUTER socket bound to tcp://127.0.0.1:5555
to receive user requests from the PySide6 QApplication main thread."

```

**Why Wrong:**

-   **FSD Violation:** Mentions specific technologies (ZeroMQ, PySide6)
-   **Mixed Abstraction:** Combines behavior (receive requests) with implementation (socket binding)
-   **Maintenance Burden:** Technology changes require FSD updates (should be isolated to SAD/TDD)

**Correct Decomposition:**

```
|FSD-1.1| ← |BRD-5|: "Core routes request-response messages between services."

|SAD-3.2| ← |FSD-1.1|, |NFR-5.1|: "Pattern: ZeroMQ ROUTER (Core) ↔ DEALER (Service)."

|ICD-1| ← |SAD-3.2|:
core:
  router_bind: "tcp://127.0.0.1:5555"

|TDD-1.3| ← |ICD-1|: "Socket: Bind ROUTER to core.router_bind (from config)."

|ISP-1| ← |TDD-1.3|:
def __init__(self, config_path: str):
    self.router = self.context.socket(zmq.ROUTER)
    self.router.bind(self.config['router_bind'])

```

----------

### 21.2 The "Orphaned Rationale" Anti-Pattern

**Problem:** Design decisions without traceability to requirements.

**Example (WRONG):**

```
|SAD-X|: "Use priority queues for message ordering."

```

**Why Wrong:**

-   **No Justification:** Doesn't explain WHY priority matters
-   **No Traceability:** Missing citation to parent requirement
-   **Incomplete:** Doesn't specify priority levels or ordering rules

**Correct Pattern:**

```
|NFR-5.1| ← |BRD-3.4|: "No process shall block waiting for another."

|SAD-4.3| ← |NFR-5.1|: "Queueing Strategy"
  |SAD-4.3.R1|: RATIONALE: Priority queues prevent control messages
  (shutdown, error) from being blocked behind long-running data
  messages, enforcing the non-blocking constraint.

  |SAD-4.4| ← |SAD-4.3|: "Must use queue.PriorityQueue."
  |SAD-4.5| ← |SAD-4.3|: "Structure: (priority, counter, message)."
  |SAD-4.8| ← |SAD-4.3|: "High Priority (0): shutdown, error_notification."
  |SAD-4.9| ← |SAD-4.3|: "Normal Priority (1): Inference requests."

```

----------

### 21.3 The "Premature Optimization" Anti-Pattern

**Problem:** Performance targets without business justification.

**Example (WRONG):**

```
|NFR-X|: "All IPC messages must complete in <100 microseconds."

```

**Why Wrong:**

-   **No Business Context:** Why does 100μs matter to users/business?
-   **Over-Specification:** May be orders of magnitude tighter than needed
-   **Implementation Constraint:** Forces expensive optimizations without ROI

**Correct Pattern:**

```
|BRD-12|: "Real-Time Conversational Experience"
Target: <5% session abandonment due to lag (current: 18%).

|NFR-11.1| ← |BRD-12|: "End-to-End Latency: ≤3s (voice-to-response, 95th percentile)."
  RATIONALE: User research shows 3s perceived as "instant",
  >5s causes frustration and abandonment.

|NFR-11.2| ← |NFR-11.1|: "Latency Budget Breakdown"
  - STT: 500ms (allows buffering for VAD endpoint detection)
  - LLM: 1500ms (achievable with INT4 quantization on RTX 3080)
  - TTS: 800ms (streaming synthesis, first audio chunk <200ms)
  - IPC: 200ms (total overhead across all routing)

  RATIONALE: Budget allocates majority to inference tasks (80%),
  minimizes overhead (7%), provides margin for 95th percentile variance.

|NFR-4.2| ← |NFR-11.2|: "IPC Round Trip: <20ms for 1MB payload."
  RATIONALE: 200ms total IPC budget / 10 average messages per request = 20ms each.

```

----------
