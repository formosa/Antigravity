
## 15. Documentation Evolution Strategies

### 15.1 Version Control Integration

**Tag Stability Across Versions:**

~~~rst
VERSION 1.0:
.. fsd:: Wake Word: Always-on detection using pvporcupine.
   :id: FSD-4.1

VERSION 2.0:
.. fsd:: Wake Word: Always-on detection using pvporcupine.
   :id: FSD-4.1

.. fsd:: Multi-Wake-Word: Support custom wake phrases via training API.
   :id: FSD-4.6 (NEW)
~~~

**Rules:**

1.  **Never Delete Tags:** Mark as DEPRECATED instead
2.  **Never Renumber:** Add new sequential IDs (e.g., .6, .7)
3.  **Maintain Citations:** Old tags remain valid parents

**Deprecation Pattern:**

~~~rst
.. nfr:: Memory (Core Queue): 1000 cap. [DEPRECATED v2.0 → See NFR-13.1]
   :id: NFR-3.3

.. nfr:: Memory (Core Queue): Dynamic sizing, 500-5000 cap.
   :id: NFR-13.1
   :links: NFR-3.3
~~~

### 15.2 Feature Flag Documentation

For gradual rollouts, extend tags with feature flag markers:

~~~rst
.. fsd:: Streaming TTS Synthesis [FEATURE_FLAG: streaming_tts]
   :id: FSD-15

.. fsd:: UI plays audio chunks as generated (no full buffer wait).
   :id: FSD-15.1
   :links: FSD-15

.. fsd:: Runtime yields TTS frames incrementally.
   :id: FSD-15.2
   :links: FSD-15

.. sad:: Streaming TTS Pattern [FEATURE_FLAG: streaming_tts]
   :id: SAD-13
   :links: FSD-15

.. sad:: Pattern: Generator-based synthesis with chunk yields.
   :id: SAD-13.1
   :links: SAD-13

.. sad:: Protocol: WebSocket for real-time audio frames.
   :id: SAD-13.2
   :links: SAD-13
~~~

**Configuration Hook:**

~~~rst
.. icd:: Streaming TTS Configuration
   :id: ICD-12
   :links: SAD-13

   .. code-block:: yaml

      features:
        streaming_tts:
          enabled: false  # Toggle without code changes
          chunk_size_ms: 200
~~~

### 15.3 Migration Paths

When refactoring requires tag restructuring:

**Before (V1):**

~~~rst
.. fsd:: Audio Acquisition
   :id: FSD-4

.. fsd:: Wake Word
   :id: FSD-4.1
   :links: FSD-4

.. fsd:: VAD Stage 1
   :id: FSD-4.2
   :links: FSD-4

.. fsd:: VAD Stage 2
   :id: FSD-4.3
   :links: FSD-4
~~~

**After (V2 - Reorganized):**

~~~rst
.. fsd:: Audio Acquisition [RESTRUCTURED v2.0]
   :id: FSD-4

   → See FSD-4-V2 for current specification

.. fsd:: Audio Processing Pipeline
   :id: FSD-4-V2

.. fsd:: Wake Word Detection
   :id: FSD-4-V2.1
   :links: FSD-4.1 (legacy)

.. fsd:: Voice Activity Detection
   :id: FSD-4-V2.2
   :links: FSD-4-V2

.. fsd:: Stage 1 (webrtcvad)
   :id: FSD-4-V2.2.1
   :links: FSD-4.2 (legacy)

.. fsd:: Stage 2 (Silero)
   :id: FSD-4-V2.2.2
   :links: FSD-4.3 (legacy)

.. fsd:: Noise Reduction
   :id: FSD-4-V2.3 (NEW)
   :links: FSD-4-V2
~~~

**Migration Manifest:**

~~~rst
.. migration_manifest:: v2.0
   :date: "2026-03-15"

   .. code-block:: yaml

      changes:
        - type: "restructure"
          old_root: "FSD-4"
          new_root: "FSD-4-V2"
          mapping:
            "FSD-4.1": "FSD-4-V2.1"
            "FSD-4.2": "FSD-4-V2.2.1"
            "FSD-4.3": "FSD-4-V2.2.2"
~~~

----------
