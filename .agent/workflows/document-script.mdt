---
description: Orchestrator. Applies comprehensive Numpy-style docstrings to a targeted Python file. Enforces strict AST verification to ensure zero logic alteration.
activationMode: manual
alias: /document-script
executionEnvironment: local
---

# Workflow: Document Script (Numpy Style)

This workflow applies industry-standard documentation to Python code while acting as a **fiduciary for code integrity**. It uses a "Sandbox & Verify" pattern to ensure that the addition of comments/docstrings never breaks executable logic.

## Input Parameters
The user must provide:
- `target_file`: Relative path to the Python script (e.g., `src/utils/audit.py`).

## Operational Protocol

### Phase 1: Infrastructure & Safety
1.  **Sandboxing**:
    * **Action**: Invoke tool `/generate_uuid` to create a unique workspace ID.
    * **Context**: Store this UUID. Construct the path: `.agent/.sandbox/task-<UUID>`.
    * **Variable**: Refer to this path as `$SANDBOX`.

2.  **Pre-Flight Syntax Check**:
    * **Command**: Validate the source file before touching it.
    * ```powershell
        & "${workspaceFolder}/.venv/Scripts/python.exe" -m py_compile "${workspaceFolder}/<target_file>"
        ```
    * **On Failure**: **HALT**. Report syntax error to user.

3.  **Staging (Atomic Backup)**:
    * **Command**: Copy the target file to the sandbox.
    * ```powershell
        New-Item -ItemType Directory -Force -Path "${workspaceFolder}/$SANDBOX"
        Copy-Item "${workspaceFolder}/<target_file>" "${workspaceFolder}/$SANDBOX/original.py"
        ```

### Phase 2: Generative Intelligence
**Instruction to Agent:** Read `${workspaceFolder}/$SANDBOX/original.py`. Generate a fully documented version of this code and save it to `${workspaceFolder}/$SANDBOX/modified.py`.

**Strict Constraints:**
1.  **Logic Preservation**: You MUST NOT change variable names, logic flow, or operation order. The AST must remain identical.
2.  **Style Guide**: Use **Numpy Style** docstrings.
3.  **Reference Material**: If it exists, read `.agent/workflows/assets/numpy-style-doc-example.py` for style matching.
4.  **Legacy Content**: You must preserve useful existing comments. If an existing docstring contains "Application Notes" or "Cross-Reference" info, merge it into the `Notes` or `See Also` section of the new docstring.

**Documentation Schema (Apply where applicable):**

| Item Type | Required Sections | Conditional Sections |
| :--- | :--- | :--- |
| **Module** | Summary | Notes (Implementation details), See Also, Examples |
| **Class** | Summary | Parameters (`__init__`), Attributes, Raises, Examples |
| **Method** | Summary | Parameters (with Types), Returns, Raises, Warns |
| **Property** | Summary, Returns | Notes (if complex) |
| **Exception** | Summary | Parameters, Examples |

*Note: Always include type hints in the `Parameters` section of the docstring, even if the function signature lacks them.*

### Phase 3: Gatekeeper Verification
1.  **AST Comparison**:
    * **Action**: Invoke tool `/ast_compare`.
    * **Arguments**:
        * `original_file`: `"${workspaceFolder}/$SANDBOX/original.py"`
        * `modified_file`: `"${workspaceFolder}/$SANDBOX/modified.py"`

2.  **Decision Logic**:
    * **IF Exit Code 0 (Success)**:
        * **Action**: Deploy the changes.
        * ```powershell
            Copy-Item "${workspaceFolder}/$SANDBOX/modified.py" "${workspaceFolder}/<target_file>" -Force
            ```
        * **Cleanup**: Remove the sandbox.
        * ```powershell
            Remove-Item "${workspaceFolder}/$SANDBOX" -Recurse -Force
            ```
        * **Report**: "Success: Docstrings applied and verified."

    * **IF Exit Code 1 (Logic Mismatch)**:
        * **Action**: **HALT**. Do not overwrite the user's file.
        * **Report**: "CRITICAL FAILURE: The generated docstrings altered code logic. The unsafe file is preserved at `$SANDBOX/modified.py` for manual review."

    * **IF Exit Code 2 (Error)**:
        * **Action**: HALT. Report system error.

### Phase 4: Final Loop (Agent Autonomy)
* If `/ast_compare` failed, you (The Agent) are permitted to **Retry Once** by analyzing the diff, correcting the logic error in `modified.py`, and re-running Phase 3.
* If failure persists after 1 retry, stop and ask for human intervention.
