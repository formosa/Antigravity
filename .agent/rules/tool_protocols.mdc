---\ndescription: Strict protocols for custom tool execution and context regeneration.\nglobs: []\nalwaysApply: false\n---\n# CUSTOM TOOL PROTOCOLS\n\n## PROTOCOL: CONTEXT REGENERATION\n**Trigger Phrase:** `/refresh_context`\n\n**Purpose:** Rebuild the Sphinx documentation database and regenerate the flattened LLM context file (`docs/llm_export/context_flat.md`).\n\n**Strict Execution Path:**\nIf the user input contains the trigger phrase above (exact match):\n1.  **Verify Prerequisites:**\n    * Check if `.venv/Scripts/python` exists.\n    * Check if `.agent/tools/generate_llm_context.py` exists.\n    * **IF MISSING:** Output "ERROR: Required tooling not found." and **STOP**.\n2.  **Build Sphinx Needs Database:**\n    * Execute: `.venv\\Scripts\\python -m sphinx -b needs docs docs/_build/json`\n    * **IF EXIT CODE != 0:** Report Sphinx errors and **STOP**.\n3.  **Generate Context:**\n    * Execute: `.venv\\Scripts\\python .agent/tools/generate_llm_context.py docs/_build/json/needs.json docs/llm_export/context_flat.md`\n    * **IF EXIT CODE != 0:** Report script errors and **STOP**.\n4.  **Verify Success:**\n    * Read the first 10 lines of `docs/llm_export/context_flat.md`.\n    * Confirm the header: `# Maggie Application Framework - Context Dump`.\n5.  **Output:** "Context successfully regenerated. [X] requirements processed."
